Parameters:
  EnvironmentName:
    Description: Environment Name
    Type: String
    Default: QC
    AllowedValues: [Production, Developement, QC]

Mappings:
  RegionMap01:
    ap-northeast-1:
      KEY01: ami-09d28faae2e9e7138

  EnvironmentInstance:
    Production:
      InstanceType: t2.small
    Developement:
      InstanceType: t2.micro
    QC:
      InstanceType: t2.micro

Resources:
  MyInstance01:
    Type: AWS::EC2::Instance
    Properties:
      AvailabilityZone: ap-northeast-1a
      ImageId: !FindInMap [RegionMap01, !Ref 'AWS::Region', KEY01] 
      InstanceType: !FindInMap [EnvironmentInstance, !Ref 'EnvironmentName', InstanceType]
      KeyName: TOKYO_KEYPAIR
      SecurityGroups: 
      - !Ref SSHSecurityGroup
      - !Ref HTTPSecuritygroup

  SSHSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: SSH Access
      GroupName: sg0101
      SecurityGroupIngress:
      - CidrIp: 0.0.0.0/0
        FromPort: 22
        IpProtocol: tcp
        ToPort: 22 

  HTTPSecuritygroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: HTTP Access
      GroupName: sg0202 
      SecurityGroupIngress:
      - CidrIp: 0.0.0.0/0
        FromPort: 443
        IpProtocol: tcp
        ToPort: 443 

  MyEIP:
    Type: AWS::EC2::EIP
    Properties:
      InstanceId: !Ref MyInstance01